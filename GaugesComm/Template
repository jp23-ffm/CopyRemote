{% extends 'common/dashboard_base.html' %}

{% block title %}Server Quality Dashboard{% endblock %}

{% block dashboard_title %}{{ title }}{% endblock %}

{% block dashboard_meta %}
    Last analysis: {{ snapshot.analysis_date|date:"d M Y H:i" }}<br>
    Duration: {{ snapshot.duration_seconds|floatformat:1 }}s
{% endblock %}

{% block hero_section %}
    <div class="hero-section">
        {% for widget in widgets %}
            {% if widget.size == 'large' %}
            <div class="hero-gauge">
                <h2>{{ widget.title }}</h2>
                <div class="hero-gauge-container">
                    <canvas id="gauge-{{ widget.id }}"></canvas>
                    <div class="hero-gauge-value">{{ widget.display_value }}</div>
                </div>
                <div class="hero-gauge-stats">
                    <div>Clean: <span>{{ snapshot.servers_clean }}</span></div>
                    <div>Issues: <span>{{ snapshot.servers_with_issues }}</span></div>
                    <div>Total: <span>{{ snapshot.total_servers_analyzed }}</span></div>
                </div>
            </div>
            {% endif %}
        {% endfor %}
    </div>
{% endblock %}

{% block widgets_grid %}
    <div class="gauges-grid">
        {% for widget in widgets %}
            {% if widget.size == 'small' %}
            <a href="{{ widget.link }}" class="gauge-card">
                <div class="gauge-card-header">
                    <span class="gauge-card-icon">{{ widget.icon }}</span>
                    <h3 class="gauge-card-title">{{ widget.title }}</h3>
                </div>
                <div class="gauge-card-canvas-container">
                    <canvas id="gauge-{{ widget.id }}"></canvas>
                    <div class="gauge-card-value">{{ widget.display_value }}</div>
                </div>
                <div class="gauge-card-detail">{{ widget.detail }}</div>
                <span class="gauge-card-link">View All â†’</span>
            </a>
            {% endif %}
        {% endfor %}
    </div>
{% endblock %}

{% block extra_js %}
    <script>
        // Initialise les gauges
        {% for widget in widgets %}
        createGauge(
            'gauge-{{ widget.id }}',
            {{ widget.value }},
            {{ widget.thresholds|safe }},
            {{ widget.colors|safe }},
            {{ widget.size == 'large'|lower }}
        );
        {% endfor %}
    </script>
{% endblock %}
