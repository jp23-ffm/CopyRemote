<script>
(function() {
    // Les données restent ici
    const serversData = {
        {% for server_group in page_obj.object_list %}
            "{{ server_group.hostname }}": {
                {% for field in model_fields %}
                    "{{ field.name }}": {% if field.name in server_group.constant_fields %}"{{ server_group.constant_fields|lookup:field.name|escapejs }}"{% elif field.name in server_group.variable_fields %}{{ server_group.variable_fields|lookup:field.name|safe }}{% else %}null{% endif %}{% if not forloop.last %},{% endif %}
                {% endfor %}
                {% if server_group.annotation %},
                    "annotation": {
                        "notes": "{{ server_group.annotation.notes|escapejs }}",
                        "type": "{{ server_group.annotation.type|escapejs }}",
                        "servicenow": "{{ server_group.annotation.servicenow|escapejs }}",
                        "updated_at": "{{ server_group.annotation.updated_at }}"
                    }
                {% endif %}
            }{% if not forloop.last %},{% endif %}
        {% endfor %}
    };
    
    const fieldLabels = {{ json_data|safe }};
    
    // Fonctions identiques...
    window.openServerModal = function(hostname) { /* ... */ };
    window.closeServerModal = function() { /* ... */ };
    
    // Event listeners
    document.getElementById('serverDetailsModal').addEventListener('click', function(e) {
        if (e.target === this) {
            closeServerModal();
        }
    });
    
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            const modal = document.getElementById('serverDetailsModal');
            if (modal && modal.style.display === 'block') {
                closeServerModal();
            }
        }
    });
    
    document.addEventListener('DOMContentLoaded', function() {
        // NOUVEAU : Déplacer le modal au body
        const modal = document.getElementById('serverDetailsModal');
        if (modal && modal.parentElement !== document.body) {
            document.body.appendChild(modal);
        }
        
        // Ajouter les event listeners sur les cellules
        const hostnameCells = document.querySelectorAll('.hostname-cell');
        
        hostnameCells.forEach(cell => {
            cell.addEventListener('contextmenu', function(e) {
                e.preventDefault();
                const row = this.closest('tr');
                const hostname = row.getAttribute('data-hostname');
                if (hostname) {
                    openServerModal(hostname);
                }
            });
            
            cell.addEventListener('dblclick', function(e) {
                const row = this.closest('tr');
                const hostname = row.getAttribute('data-hostname');
                if (hostname) {
                    openServerModal(hostname);
                }
            });
        });
    });
})();
</script>
