// common/static/common/js/chart-modal.js

let chartsLoaded = false;
let currentAppName = 'inventory';  // Variable globale pour stocker l'app

// Initialiser avec le nom de l'app
function initChartModal(jsonData, appName) {
    availableFields = jsonData.chartable_fields || {};
    currentAppName = appName;  // ‚Üê Stocker l'app
}

// Charger au premier focus
function onSavedChartSelectFocus() {
    if (chartsLoaded) return;
    loadSavedChartsList();
    chartsLoaded = true;
}

// Charger la liste - FILTRER par app
async function loadSavedChartsList() {
    try {
        // PASSER l'app en param√®tre
        const response = await fetch(`/common/api/charts/list/?app=${currentAppName}`);
        
        if (!response.ok) {
            console.error('HTTP error:', response.status);
            return;
        }
        
        const data = await response.json();
        const select = document.getElementById('savedChartSelect');
        
        if (!select) return;
        
        select.innerHTML = '<option value="">üìÇ Load saved view...</option>';
        
        if (data.success && Array.isArray(data.charts) && data.charts.length > 0) {
            data.charts.forEach(chart => {
                const option = document.createElement('option');
                option.value = chart.id;
                option.textContent = chart.name;
                option.dataset.filters = JSON.stringify(chart.filters);
                select.appendChild(option);
            });
        } else {
            const option = document.createElement('option');
            option.value = '';
            option.textContent = '(No saved views yet)';
            option.disabled = true;
            select.appendChild(option);
        }
        
    } catch (error) {
        console.error('Error loading saved charts:', error);
    }
}

// ... reste du code identique (loadSavedChartAuto, deleteSelectedChart, etc.)
