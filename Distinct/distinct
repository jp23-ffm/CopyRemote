# Après get_filtered_servers
servers = get_filtered_servers(requestfilters, permanent_filter_selection)

# Ne garder que SERVER_ID + les champs sélectionnés, puis distinct
fields_to_keep = ['SERVER_ID'] + list(selected_fields.keys())
servers = servers.values(*fields_to_keep).distinct('SERVER_ID')



 # Réduire aux champs nécessaires et dédupliquer
fields_to_keep = ['SERVER_ID'] + list(selected_fields.keys())

unique_servers = {}
for server in servers:
    server_id = server.get('SERVER_ID')
    if server_id not in unique_servers:
        # Ne garder que les champs voulus
        reduced_server = {field: server.get(field) for field in fields_to_keep}
        unique_servers[server_id] = reduced_server

servers = list(unique_servers.values())



import pandas as pd

fields_to_keep = ['SERVER_ID'] + list(selected_fields.keys())
df = pd.DataFrame(servers)
servers = df[fields_to_keep].drop_duplicates(subset=['SERVER_ID']).to_dict('records')



# Récupérer seulement les champs nécessaires
fields_to_keep = ['SERVER_ID'] + list(selected_fields.keys())
servers_list = list(servers.values(*fields_to_keep))

# Dédupliquer par SERVER_ID
seen_ids = set()
unique_servers = []
for server in servers_list:
    server_id = server['SERVER_ID']
    if server_id not in seen_ids:
        seen_ids.add(server_id)
        unique_servers.append(server)

servers = unique_servers

          
