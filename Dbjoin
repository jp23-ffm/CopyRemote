def server_view(request):
    country_filter = request.GET.get('country')
    
    if country_filter:
        matching_inventory = InventoryServer.objects.filter(Country=country_filter)
        valid_server_ids = list(matching_inventory.values_list('SERVER_ID', flat=True))
        
        # Découpe en chunks de 999
        chunk_size = 999
        all_servers = Server.objects.none()  # QuerySet vide
        
        for i in range(0, len(valid_server_ids), chunk_size):
            chunk = valid_server_ids[i:i + chunk_size]
            all_servers = all_servers | Server.objects.filter(SERVER_ID__in=chunk)
        
        all_servers = all_servers.select_related('server_unique')
        inventory_dict = {inv.SERVER_ID: inv for inv in matching_inventory}
    else:
        all_servers = Server.objects.all().select_related('server_unique')
        server_ids = all_servers.values_list('SERVER_ID', flat=True)
        inventory_dict = {
            inv.SERVER_ID: inv
            for inv in InventoryServer.objects.filter(SERVER_ID__in=server_ids)
        }
    
    # Continue...








def server_view(request):
    # Récupère les filtres de l'URL
    country_filter = request.GET.get('country')
    
    # Si filtre sur Country, commence par Inventory
    if country_filter:
        # Filtre Inventory d'abord
        matching_inventory = InventoryServer.objects.filter(Country=country_filter)
        valid_server_ids = list(matching_inventory.values_list('SERVER_ID', flat=True))
        
        # Filtre tes serveurs avec ces IDs
        all_servers = Server.objects.filter(SERVER_ID__in=valid_server_ids).select_related('server_unique')
        
        # Le dict est déjà filtré
        inventory_dict = {inv.SERVER_ID: inv for inv in matching_inventory}
    else:
        # Pas de filtre Country, process normal
        all_servers = Server.objects.all().select_related('server_unique')
        server_ids = all_servers.values_list('SERVER_ID', flat=True)
        inventory_dict = {
            inv.SERVER_ID: inv
            for inv in InventoryServer.objects.filter(SERVER_ID__in=server_ids)
        }
    
    # Continue avec tes autres filtres sur all_servers
    # Ex: all_servers = all_servers.filter(ITCONTINUITY_LEVEL='HIGH')
    
    # Pagination...
    # Boucle pour créer servers_for_template...











from inventory.models import InventoryServer
from continuity.models import ContinuityServer

def ma_vue(request):
    # Récupère tous tes serveurs Continuity
    continuity_servers = ContinuityServer.objects.all()
    
    # Crée un dictionnaire pour mapper SERVER_ID -> Country
    inventory_dict = {
        inv.SERVER_ID: inv.Country 
        for inv in InventoryServer.objects.all()
    }
    
    # Ajoute dynamiquement le champ Country à chaque serveur
    for server in continuity_servers:
        server.country = inventory_dict.get(server.SERVER_ID)
    
    return render(request, 'template.html', {'servers': continuity_servers})



{% for server in servers %}
    <tr>
        <td>{{ server.SERVER_ID }}</td>
        <td>{{ server.country }}</td>
        <!-- tes autres champs -->
    </tr>
{% endfor %}


server_ids = continuity_servers.values_list('SERVER_ID', flat=True)
inventory_dict = {
    inv.SERVER_ID: inv.Country 
    for inv in InventoryServer.objects.filter(SERVER_ID__in=server_ids)
}



